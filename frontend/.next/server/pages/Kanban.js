"use strict";(()=>{var e={};e.id=6614,e.ids=[6614,660],e.modules={1323:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},79322:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>y,default:()=>p,getServerSideProps:()=>f,getStaticPaths:()=>h,getStaticProps:()=>m,reportWebVitals:()=>S,routeModule:()=>I,unstable_getServerProps:()=>k,unstable_getServerSideProps:()=>v,unstable_getStaticParams:()=>x,unstable_getStaticPaths:()=>P,unstable_getStaticProps:()=>b});var s=r(87093),o=r(35244),n=r(1323),i=r(55388),l=r.n(i),u=r(16769),c=r.n(u),d=r(94285),g=e([d]);d=(g.then?(await g)():g)[0];let p=(0,n.l)(d,"default"),m=(0,n.l)(d,"getStaticProps"),h=(0,n.l)(d,"getStaticPaths"),f=(0,n.l)(d,"getServerSideProps"),y=(0,n.l)(d,"config"),S=(0,n.l)(d,"reportWebVitals"),b=(0,n.l)(d,"unstable_getStaticProps"),P=(0,n.l)(d,"unstable_getStaticPaths"),x=(0,n.l)(d,"unstable_getStaticParams"),k=(0,n.l)(d,"unstable_getServerProps"),v=(0,n.l)(d,"unstable_getServerSideProps"),I=new s.PagesRouteModule({definition:{kind:o.x.PAGES,page:"/Kanban",pathname:"/Kanban",bundlePath:"",filename:""},components:{App:c(),Document:l()},userland:d});a()}catch(e){a(e)}})},16769:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let a=r(50167)._(r(16689)),s=r(96221);async function o(e){let{Component:t,ctx:r}=e;return{pageProps:await (0,s.loadGetInitialProps)(t,r)}}class n extends a.default.Component{render(){let{Component:e,pageProps:t}=this.props;return a.default.createElement(e,t)}}n.origGetInitialProps=o,n.getInitialProps=o,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},58582:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{V:()=>i}),r(20997);var s=r(16689),o=r(85425),n=e([o]);o=(n.then?(await n)():n)[0];let i=(0,s.createContext)();a()}catch(e){a(e)}})},151:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>u});var s=r(3590),o=r(92921),n=r(97026),i=r.n(n),l=e([s]);s=(l.then?(await l)():l)[0];let u=e=>{let t=e.response?.data?.error;if(t){if(o.a.exists(`backendErrors.${t}`)){s.toast.error(o.a.t(`backendErrors.${t}`),{toastId:t,autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!1,draggable:!0,progress:void 0,theme:"light"});return}s.toast.error(t,{toastId:t,autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!1,draggable:!0,progress:void 0,theme:"light"});return}if(i()(e)){s.toast.error(e);return}s.toast.error("An error occurred!")};a()}catch(e){a(e)}})},85425:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>S});var s=r(16689),o=r(14661),n=r(98210),i=r.n(n),l=r(35599),u=r.n(l),c=r(3590),d=r(92921),g=r(38561),p=r(151),m=r(7405),h=r(32245),f=r.n(h),y=e([c,p,m]);[c,p,m]=y.then?(await y)():y;let S=()=>{let e=(0,o.useNavigate)(),[t,r]=(0,s.useState)(!1),[a,n]=(0,s.useState)(!0),[l,h]=(0,s.useState)({});g.Z.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${JSON.parse(t)}`,r(!0)),e},e=>{Promise.reject(e)}),g.Z.interceptors.response.use(e=>e,async e=>{let t=e.config;if(e?.response?.status===403&&!t._retry){t._retry=!0;let{data:e}=await g.Z.post("/auth/refresh_token");return e&&(localStorage.setItem("token",JSON.stringify(e.token)),g.Z.defaults.headers.Authorization=`Bearer ${e.token}`),(0,g.Z)(t)}return e?.response?.status===401&&(localStorage.removeItem("token"),localStorage.removeItem("companyId"),g.Z.defaults.headers.Authorization=void 0,r(!1)),Promise.reject(e)}),(0,s.useEffect)(()=>{let e=localStorage.getItem("token");(async()=>{if(e)try{let{data:e}=await g.Z.post("/auth/refresh_token");g.Z.defaults.headers.Authorization=`Bearer ${e.token}`,r(!0),h(e.user)}catch(e){(0,p.Z)(e)}n(!1)})()},[]),(0,s.useEffect)(()=>{let e=localStorage.getItem("companyId");if(e){let t=(0,m.C)({companyId:e});return t.on(`company-${e}-user`,e=>{"update"===e.action&&e.user.id===l.id&&h(e.user)}),()=>{t.disconnect()}}},[l]);let y=async t=>{n(!0);try{let{data:l}=await g.Z.post("/auth/login",t),{user:{companyId:m,id:y,company:S}}=l;if(i()(S,"settings")&&u()(S.settings)){let e=S.settings.find(e=>"campaignsEnabled"===e.key);e&&"true"===e.value&&localStorage.setItem("cshow",null)}f().locale("pt-br");let b=l.user.company.dueDate;f()(f()()).format("DD/MM/yyyy");let P=f()(b).format("DD/MM/yyyy");var a=f()(b).diff(f()(f()()).format()),s=f()(f()().format()).isBefore(b),o=f().duration(a).asDays();!0===s?(localStorage.setItem("token",JSON.stringify(l.token)),localStorage.setItem("companyId",m),localStorage.setItem("userId",y),localStorage.setItem("companyDueDate",P),g.Z.defaults.headers.Authorization=`Bearer ${l.token}`,h(l.user),r(!0),c.toast.success(d.a.t("auth.toasts.success")),5>Math.round(o)&&c.toast.warn(`Sua assinatura vence em ${Math.round(o)} ${1===Math.round(o)?"dia":"dias"} `),e.push("/tickets")):(0,p.Z)(`Opss! Sua assinatura venceu ${P}.
Entre em contato com o Suporte para mais informa\xe7\xf5es! `),n(!1)}catch(e){(0,p.Z)(e),n(!1)}},S=async()=>{n(!0);try{await g.Z.delete("/auth/logout"),r(!1),h({}),localStorage.removeItem("token"),localStorage.removeItem("companyId"),localStorage.removeItem("userId"),localStorage.removeItem("cshow"),g.Z.defaults.headers.Authorization=void 0,n(!1),e.push("/login")}catch(e){(0,p.Z)(e),n(!1)}},b=async()=>{try{let{data:e}=await g.Z.get("/auth/me");return e}catch(e){(0,p.Z)(e)}};return{isAuth:t,user:l,loading:a,handleLogin:y,handleLogout:S,getCurrentUserInfo:b}};a()}catch(e){a(e)}})},94285:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>y});var s=r(20997),o=r(16689),n=r(48308),i=r(38561),l=r(58582),u=r(7129),c=r.n(u),d=r(3590),g=r(92921),p=r(14661),m=r(7405),h=e([l,d,m]);[l,d,m]=h.then?(await h)():h;let f=(0,n.makeStyles)(e=>({root:{display:"flex",alignItems:"center",padding:e.spacing(1)},button:{background:"#10a110",border:"none",padding:"10px",color:"white",fontWeight:"bold",borderRadius:"5px"}})),y=()=>{let e=f(),t=(0,p.useNavigate)(),[r,a]=(0,o.useState)([]),[n,u]=(0,o.useState)(!1),[m,h]=(0,o.useState)(!1),y=async()=>{try{let e=(await i.Z.get("/tags/kanban")).data.lista||[];a(e),await A(_)}catch(e){console.log(e)}};(0,o.useEffect)(()=>{y()},[]);let[S,b]=(0,o.useState)({lanes:[]}),[P,x]=(0,o.useState)([]),{user:k}=(0,o.useContext)(l.V),{profile:v,queues:I}=k,_=k.queues.map(e=>e.UserQueue.queueId),A=async e=>{try{let{data:t}=await i.Z.get("/ticket/kanban",{params:{queueIds:JSON.stringify(e),teste:!0}});x(t.tickets)}catch(e){console.log(e),x([])}},w=t=>{let a=P.filter(e=>0===e.tags.length),o=[{id:"lane0",title:g.a.t("Em aberto"),label:"0",cards:a.map(t=>({id:t.id.toString(),label:"Ticket n\xba "+t.id.toString(),description:(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:[t.contact.number,s.jsx("br",{}),t.lastMessage]}),s.jsx("button",{className:e.button,onClick:()=>{Z(t.uuid)},children:"Ver Ticket"})]}),title:t.contact.name,draggable:!0,href:"/tickets/"+t.uuid}))},...r.map(t=>{let r=P.filter(e=>e.tags.map(e=>e.id).includes(t.id));return{id:t.id.toString(),title:t.name,label:t.id.toString(),cards:r.map(t=>({id:t.id.toString(),label:"Ticket n\xba "+t.id.toString(),description:(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:[t.contact.number,s.jsx("br",{}),t.lastMessage]}),s.jsx("button",{className:e.button,onClick:()=>{console.log(t.uuid),Z(t.uuid)},children:"Ver Ticket"})]}),title:t.contact.name,draggable:!0,href:"/tickets/"+t.uuid})),style:{backgroundColor:t.color,color:"white"}}})];b({lanes:o})},Z=e=>{t.push("/tickets/"+e)};(0,o.useEffect)(()=>{w(_)},[r,P,n]);let j=async(e,t,r)=>{try{await i.Z.delete(`/ticket-tags/${r}`),d.toast.success("Ticket Tag Removido!"),await i.Z.put(`/ticket-tags/${r}/${t}`),d.toast.success("Ticket Tag Adicionado com Sucesso!")}catch(e){console.log(e)}};return s.jsx("div",{className:e.root,children:s.jsx(c(),{data:S,onCardMoveAcrossLanes:j,style:{backgroundColor:"rgba(252, 252, 252, 0.03)"}})})};a()}catch(e){a(e)}})},7405:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{C:()=>l});var s=r(14612),o=r(75795),n=r.n(o),i=e([s]);function l(e){return localStorage.getItem("userId")&&localStorage.getItem("userId"),(0,s.default)(process.env.REACT_APP_BACKEND_URL,{transports:["websocket","polling","flashsocket"],pingTimeout:18e3,pingInterval:18e3,query:n()(e)?{...e}:{userId:e.userId}})}s=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})},35244:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},48308:e=>{e.exports=require("@material-ui/core/styles")},52167:e=>{e.exports=require("axios")},18805:e=>{e.exports=require("i18next")},86071:e=>{e.exports=require("i18next-browser-languagedetector")},98210:e=>{e.exports=require("lodash/has")},35599:e=>{e.exports=require("lodash/isArray")},75795:e=>{e.exports=require("lodash/isObject")},97026:e=>{e.exports=require("lodash/isString")},32245:e=>{e.exports=require("moment")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},16689:e=>{e.exports=require("react")},14661:e=>{e.exports=require("react-router-dom")},7129:e=>{e.exports=require("react-trello")},20997:e=>{e.exports=require("react/jsx-runtime")},3590:e=>{e.exports=import("react-toastify")},14612:e=>{e.exports=import("socket.io-client")},71017:e=>{e.exports=require("path")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[5388,5800],()=>r(79322));module.exports=a})();