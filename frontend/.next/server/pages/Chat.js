"use strict";(()=>{var e={};e.id=5440,e.ids=[5440,660],e.modules={66856:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(87462),i=a(91),s=a(16689);a(580);var n=a(68103),l=a.n(n),o=a(52543),c=s.forwardRef(function(e,t){var a=e.disableSpacing,n=e.classes,o=e.className,c=(0,i.Z)(e,["disableSpacing","classes","className"]);return s.createElement("div",(0,r.Z)({className:l()(n.root,o,!(void 0!==a&&a)&&n.spacing),ref:t},c))});let d=(0,o.Z)({root:{display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},spacing:{"& > :not(:first-child)":{marginLeft:8}}},{name:"MuiDialogActions"})(c)},29525:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(87462),i=a(91),s=a(16689);a(580);var n=a(68103),l=a.n(n),o=a(52543),c=s.forwardRef(function(e,t){var a=e.classes,n=e.className,o=e.dividers,c=(0,i.Z)(e,["classes","className","dividers"]);return s.createElement("div",(0,r.Z)({className:l()(a.root,n,void 0!==o&&o&&a.dividers),ref:t},c))});let d=(0,o.Z)(function(e){return{root:{flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"8px 24px","&:first-child":{paddingTop:20}},dividers:{padding:"16px 24px",borderTop:"1px solid ".concat(e.palette.divider),borderBottom:"1px solid ".concat(e.palette.divider)}}},{name:"MuiDialogContent"})(c)},66083:(e,t,a)=>{a.d(t,{Z:()=>u});var r=a(87462),i=a(91),s=a(16689);a(580);var n=a(68103),l=a.n(n),o=a(52543),c=a(22318),d=s.forwardRef(function(e,t){var a=e.children,n=e.classes,o=e.className,d=e.disableTypography,u=(0,i.Z)(e,["children","classes","className","disableTypography"]);return s.createElement("div",(0,r.Z)({className:l()(n.root,o),ref:t},u),void 0!==d&&d?a:s.createElement(c.Z,{component:"h2",variant:"h6"},a))});let u=(0,o.Z)({root:{margin:0,padding:"16px 24px",flex:"0 0 auto"}},{name:"MuiDialogTitle"})(d)},81860:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(87462),i=a(91),s=a(16689);a(580);var n=a(68103),l=a.n(n),o=a(52543),c=s.forwardRef(function(e,t){var a=e.classes,n=e.className,o=(0,i.Z)(e,["classes","className"]);return s.createElement("div",(0,r.Z)({className:l()(a.root,n),ref:t},o))});c.muiName="ListItemSecondaryAction";let d=(0,o.Z)({root:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"}},{name:"MuiListItemSecondaryAction"})(c)},90121:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>f,default:()=>h,getServerSideProps:()=>g,getStaticPaths:()=>x,getStaticProps:()=>m,reportWebVitals:()=>y,routeModule:()=>S,unstable_getServerProps:()=>j,unstable_getServerSideProps:()=>C,unstable_getStaticParams:()=>Z,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>v});var i=a(87093),s=a(35244),n=a(1323),l=a(55388),o=a.n(l),c=a(16769),d=a.n(c),u=a(67029),p=e([u]);u=(p.then?(await p)():p)[0];let h=(0,n.l)(u,"default"),m=(0,n.l)(u,"getStaticProps"),x=(0,n.l)(u,"getStaticPaths"),g=(0,n.l)(u,"getServerSideProps"),f=(0,n.l)(u,"config"),y=(0,n.l)(u,"reportWebVitals"),v=(0,n.l)(u,"unstable_getStaticProps"),b=(0,n.l)(u,"unstable_getStaticPaths"),Z=(0,n.l)(u,"unstable_getStaticParams"),j=(0,n.l)(u,"unstable_getServerProps"),C=(0,n.l)(u,"unstable_getServerSideProps"),S=new i.PagesRouteModule({definition:{kind:s.x.PAGES,page:"/Chat",pathname:"/Chat",bundlePath:"",filename:""},components:{App:d(),Document:o()},userland:u});r()}catch(e){r(e)}})},6133:(e,t,a)=>{a.d(t,{Z:()=>f});var r=a(20997);a(16689);var i=a(12610),s=a.n(i),n=a(81961),l=a.n(n),o=a(80929),c=a.n(o),d=a(46856),u=a.n(d),p=a(82400),h=a.n(p),m=a(54104),x=a.n(m),g=a(92921);let f=({title:e,children:t,open:a,onClose:i,onConfirm:n})=>(0,r.jsxs)(l(),{open:a,onClose:()=>i(!1),"aria-labelledby":"confirm-dialog",children:[r.jsx(h(),{id:"confirm-dialog",children:e}),r.jsx(u(),{dividers:!0,children:r.jsx(x(),{children:t})}),(0,r.jsxs)(c(),{children:[r.jsx(s(),{variant:"contained",onClick:()=>i(!1),color:"default",children:g.a.t("confirmationModal.buttons.cancel")}),r.jsx(s(),{variant:"contained",onClick:()=>{i(!1),n()},color:"secondary",children:g.a.t("confirmationModal.buttons.confirm")})]})]})},95030:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{B:()=>m});var i=a(20997),s=a(14310),n=a(16204),l=a(39803),o=a(88129),c=a.n(o),d=a(16689),u=a(151),p=a(38561),h=e([u]);function m({onFiltered:e,initialUsers:t}){let[a,r]=(0,d.useState)([]),[o,h]=(0,d.useState)([]);(0,d.useEffect)(()=>{(async function(){await m()})()},[]),(0,d.useEffect)(()=>{h([]),Array.isArray(t)&&Array.isArray(a)&&a.length>0&&x(t)},[t,a]);let m=async()=>{try{let{data:e}=await p.Z.get("/users/list"),t=e.map(e=>({id:e.id,name:e.name}));r(t)}catch(e){(0,u.Z)(e)}},x=async t=>{h(t),e(t)};return i.jsx(s.Z,{style:{padding:"0px 10px 10px"},children:i.jsx(c(),{multiple:!0,size:"small",options:a,value:o,onChange:(e,t,a)=>x(t),getOptionLabel:e=>e.name,getOptionSelected:(e,t)=>e?.id===t?.id||e?.name.toLowerCase()===t?.name.toLowerCase(),renderTags:(e,t)=>e.map((e,a)=>i.jsx(n.Z,{variant:"outlined",style:{backgroundColor:"#bfbfbf",textShadow:"1px 1px 1px #000",color:"white"},label:e.name,...t({index:a}),size:"small"})),renderInput:e=>i.jsx(l.Z,{...e,variant:"outlined",placeholder:"Filtro por Users"})})})}u=(h.then?(await h)():h)[0],r()}catch(e){r(e)}})},18892:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>C});var i=a(20997),s=a(16689),n=a(41120),l=a(16204),o=a(62822),c=a(50998),d=a(95757),u=a(81860),p=a(17812),h=a(14661),m=a(58582),x=a(74846),g=a(15652),f=a.n(g),y=a(93365),v=a.n(y),b=a(6133),Z=a(38561),j=e([m]);m=(j.then?(await j)():j)[0];let S=(0,n.Z)(e=>({mainContainer:{display:"flex",flexDirection:"column",position:"relative",flex:1,height:"calc(100% - 58px)",overflow:"hidden",borderRadius:0,backgroundColor:e.palette.boxlist},chatList:{display:"flex",flexDirection:"column",position:"relative",flex:1,overflowY:"scroll",...e.scrollbarStyles},listItem:{cursor:"pointer"}}));function C({chats:e,handleSelectChat:t,handleDeleteChat:a,handleEditChat:r,pageInfo:n,loading:g}){let y=S(),j=(0,h.useNavigate)(),{user:C}=(0,s.useContext)(m.V),{datetimeToClient:w}=(0,x.Y)(),[q,N]=(0,s.useState)(!1),[P,I]=(0,s.useState)({}),{id:M}=(0,h.useParams)(),k=async e=>{if(E(e)>0)try{await Z.Z.post(`/chats/${e.id}/read`,{userId:C.id})}catch(e){}M!==e.uuid&&(j.push(`/chats/${e.uuid}`),t(e))},E=e=>e.users.find(e=>e.userId===C.id).unreads,A=e=>{let t=e.title,a=E(e);return(0,i.jsxs)(i.Fragment,{children:[t,a>0&&i.jsx(l.Z,{size:"small",style:{marginLeft:5},label:a,color:"secondary"})]})},T=e=>""!==e.lastMessage?`${w(e.updatedAt)}: ${e.lastMessage}`:"",$=e=>({borderLeft:e.uuid===M?"6px solid #002d6e":null,backgroundColor:e.uuid===M?"theme.palette.chatlist":null});return(0,i.jsxs)(i.Fragment,{children:[i.jsx(b.Z,{title:"Excluir Conversa",open:q,onClose:N,onConfirm:()=>{a(P)},children:"Esta a\xe7\xe3o n\xe3o pode ser revertida, confirmar?"}),i.jsx("div",{className:y.mainContainer,children:i.jsx("div",{className:y.chatList,children:i.jsx(o.Z,{children:Array.isArray(e)&&e.length>0&&e.map((e,t)=>(0,i.jsxs)(c.Z,{onClick:()=>k(e),className:y.listItem,style:$(e),button:!0,children:[i.jsx(d.Z,{primary:A(e),secondary:T(e)}),e.ownerId===C.id&&(0,i.jsxs)(u.Z,{children:[i.jsx(p.Z,{onClick:()=>{k(e).then(()=>{r(e)})},edge:"end","aria-label":"delete",size:"small",style:{marginRight:5},children:i.jsx(v(),{})}),i.jsx(p.Z,{onClick:()=>{I(e),N(!0)},edge:"end","aria-label":"delete",size:"small",children:i.jsx(f(),{})})]})]},t))})})})]})}r()}catch(e){r(e)}})},67029:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{ChatModal:()=>k,default:()=>A});var i=a(20997),s=a(16689),n=a(14661),l=a(41120),o=a(93579),c=a(66083),d=a(29525),u=a(41749),p=a(39803),h=a(66856),m=a(282),x=a(57821),g=a(41423),f=a(79895),y=a(18892),v=a(24096),b=a(95030),Z=a(38561),j=a(7405),C=a(98210),S=a.n(C),w=a(75795),q=a.n(w),N=a(58582),P=a(64175),I=a.n(P),M=e([y,v,b,j,N]);[y,v,b,j,N]=M.then?(await M)():M;let E=(0,l.Z)(e=>({mainContainer:{display:"flex",flexDirection:"column",position:"relative",flex:1,padding:e.spacing(2),height:"calc(100% - 48px)",overflowY:"hidden",border:"1px solid rgba(0, 0, 0, 0.12)"},gridContainer:{flex:1,height:"100%",border:"1px solid rgba(0, 0, 0, 0.12)",backgroundColor:e.palette.dark},gridItem:{height:"100%"},gridItemTab:{height:"92%",width:"100%"},btnContainer:{textAlign:"right",padding:10}}));function k({open:e,chat:t,type:a,handleClose:r,handleLoadNewChat:n}){let[l,x]=(0,s.useState)([]),[g,f]=(0,s.useState)("");(0,s.useEffect)(()=>{if(f(""),x([]),"edit"===a){let e=t.users.map(e=>({id:e.user.id,name:e.user.name}));x(e),f(t.title)}},[t,e,a]);let y=async()=>{try{if(!g){alert("Por favor, preencha o t\xedtulo da conversa.");return}if(!l||0===l.length){alert("Por favor, selecione pelo menos um usu\xe1rio.");return}if("edit"===a)await Z.Z.put(`/chats/${t.id}`,{users:l,title:g});else{let{data:e}=await Z.Z.post("/chats",{users:l,title:g});n(e)}r()}catch(e){}};return(0,i.jsxs)(o.Z,{open:e,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[i.jsx(c.Z,{id:"alert-dialog-title",children:"Conversa"}),i.jsx(d.Z,{children:(0,i.jsxs)(u.Z,{spacing:2,container:!0,children:[i.jsx(u.Z,{xs:12,style:{padding:18},item:!0,children:i.jsx(p.Z,{label:"T\xedtulo",placeholder:"T\xedtulo",value:g,onChange:e=>f(e.target.value),variant:"outlined",size:"small",fullWidth:!0})}),i.jsx(u.Z,{xs:12,item:!0,children:i.jsx(b.B,{onFiltered:e=>x(e),initialUsers:l})})]})}),(0,i.jsxs)(h.Z,{children:[i.jsx(m.Z,{onClick:r,color:"primary",children:"Fechar"}),i.jsx(m.Z,{onClick:y,color:"primary",variant:"contained",children:"Salvar"})]})]})}let A=I()()(function(e){let t=E(),{user:a}=(0,s.useContext)(N.V),r=(0,n.useNavigate)(),[l,o]=(0,s.useState)(!1),[c,d]=(0,s.useState)("new"),[p,h]=(0,s.useState)({}),[b,C]=(0,s.useState)([]),[w,I]=(0,s.useState)({hasMore:!1}),[M,A]=(0,s.useState)([]),[T,$]=(0,s.useState)({hasMore:!1}),[D,L]=(0,s.useState)(1),[R,_]=(0,s.useState)(!1),[z,B]=(0,s.useState)(0),F=(0,s.useRef)(!0),W=(0,s.useRef)(),{id:Y}=(0,n.useParams)();(0,s.useEffect)(()=>()=>{F.current=!1},[]),(0,s.useEffect)(()=>{F.current&&X().then(e=>{let{records:t}=e;if(t.length>0&&(C(t),I(e),Y&&t.length)){let e=t.find(e=>e.uuid===Y);O(e)}})},[]),(0,s.useEffect)(()=>{q()(p)&&S()(p,"id")&&H(p.id).then(()=>{"function"==typeof W.current&&setTimeout(()=>{W.current()},300)})},[p]),(0,s.useEffect)(()=>{let e=localStorage.getItem("companyId"),t=(0,j.C)({companyId:e});return t.on(`company-${e}-chat-user-${a.id}`,e=>{if("create"===e.action&&C(t=>[e.record,...t]),"update"===e.action){let t=b.map(t=>t.id===e.record.id?(h(e.record),{...e.record}):t);C(t)}}),t.on(`company-${e}-chat`,e=>{if("delete"===e.action){let t=b.filter(t=>t.id!==+e.id);C(t),A([]),L(1),$({hasMore:!1}),h({}),r.push("/chats")}}),q()(p)&&S()(p,"id")&&t.on(`company-${e}-chat-${p.id}`,e=>{if("new-message"===e.action){A(t=>[...t,e.newMessage]);let t=b.map(t=>t.id===e.newMessage.chatId?{...e.chat}:t);C(t),W.current()}if("update"===e.action){let t=b.map(t=>t.id===e.chat.id?{...e.chat}:t);C(t),W.current()}}),()=>{t.disconnect()}},[p]);let O=e=>{try{A([]),L(1),h(e),B(1)}catch(e){}},V=async e=>{_(!0);try{await Z.Z.post(`/chats/${p.id}/messages`,{message:e})}catch(e){}_(!1)},U=async e=>{try{await Z.Z.delete(`/chats/${e.id}`)}catch(e){}},H=async e=>{_(!0);try{let{data:t}=await Z.Z.get(`/chats/${e}/messages?pageNumber=${D}`);L(e=>e+1),$(t),A(e=>[...t.records,...e])}catch(e){}_(!1)},G=async()=>{R||H(p.id)},X=async()=>{try{let{data:e}=await Z.Z.get("/chats");return e}catch(e){console.log(e)}};return(0,i.jsxs)(i.Fragment,{children:[i.jsx(k,{type:c,open:l,chat:p,handleLoadNewChat:e=>{A([]),L(1),h(e),B(1),r.push(`/chats/${e.uuid}`)},handleClose:()=>o(!1)}),i.jsx(f.Z,{className:t.mainContainer,children:(0,P.isWidthUp)("md",e.width)?(0,i.jsxs)(u.Z,{className:t.gridContainer,container:!0,children:[(0,i.jsxs)(u.Z,{className:t.gridItem,md:3,item:!0,children:[i.jsx("div",{className:t.btnContainer,children:i.jsx(m.Z,{onClick:()=>{d("new"),o(!0)},color:"primary",variant:"contained",children:"Nova"})}),i.jsx(y.default,{chats:b,pageInfo:w,loading:R,handleSelectChat:e=>O(e),handleDeleteChat:e=>U(e),handleEditChat:()=>{d("edit"),o(!0)}})]}),i.jsx(u.Z,{className:t.gridItem,md:9,item:!0,children:q()(p)&&S()(p,"id")&&i.jsx(v.default,{chat:p,scrollToBottomRef:W,pageInfo:T,messages:M,loading:R,handleSendMessage:V,handleLoadMore:G})})]}):(0,i.jsxs)(u.Z,{className:t.gridContainer,container:!0,children:[i.jsx(u.Z,{md:12,item:!0,children:(0,i.jsxs)(x.Z,{value:z,indicatorColor:"primary",textColor:"primary",onChange:(e,t)=>B(t),"aria-label":"disabled tabs example",children:[i.jsx(g.Z,{label:"Chats"}),i.jsx(g.Z,{label:"Mensagens"})]})}),0===z&&(0,i.jsxs)(u.Z,{className:t.gridItemTab,md:12,item:!0,children:[i.jsx("div",{className:t.btnContainer,children:i.jsx(m.Z,{onClick:()=>o(!0),color:"primary",variant:"contained",children:"Novo"})}),i.jsx(y.default,{chats:b,pageInfo:w,loading:R,handleSelectChat:e=>O(e),handleDeleteChat:e=>U(e)})]}),1===z&&i.jsx(u.Z,{className:t.gridItemTab,md:12,item:!0,children:q()(p)&&S()(p,"id")&&i.jsx(v.default,{scrollToBottomRef:W,pageInfo:T,messages:M,loading:R,handleSendMessage:V,handleLoadMore:G})})]})})]})});r()}catch(e){r(e)}})},12610:e=>{e.exports=require("@material-ui/core/Button")},81961:e=>{e.exports=require("@material-ui/core/Dialog")},80929:e=>{e.exports=require("@material-ui/core/DialogActions")},46856:e=>{e.exports=require("@material-ui/core/DialogContent")},82400:e=>{e.exports=require("@material-ui/core/DialogTitle")},54104:e=>{e.exports=require("@material-ui/core/Typography")},55223:e=>{e.exports=require("@material-ui/core/colors")},64175:e=>{e.exports=require("@material-ui/core/withWidth")},15652:e=>{e.exports=require("@material-ui/icons/Delete")},93365:e=>{e.exports=require("@material-ui/icons/Edit")},4662:e=>{e.exports=require("@material-ui/icons/Send")},88129:e=>{e.exports=require("@material-ui/lab/Autocomplete")},43349:e=>{e.exports=require("@material-ui/styles")},95027:e=>{e.exports=require("@material-ui/system")},23874:e=>{e.exports=require("@material-ui/utils")},52167:e=>{e.exports=require("axios")},68103:e=>{e.exports=require("clsx")},18805:e=>{e.exports=require("i18next")},86071:e=>{e.exports=require("i18next-browser-languagedetector")},98210:e=>{e.exports=require("lodash/has")},35599:e=>{e.exports=require("lodash/isArray")},75795:e=>{e.exports=require("lodash/isObject")},97026:e=>{e.exports=require("lodash/isString")},32245:e=>{e.exports=require("moment")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},580:e=>{e.exports=require("prop-types")},16689:e=>{e.exports=require("react")},66405:e=>{e.exports=require("react-dom")},14661:e=>{e.exports=require("react-router-dom")},84466:e=>{e.exports=require("react-transition-group")},20997:e=>{e.exports=require("react/jsx-runtime")},3590:e=>{e.exports=import("react-toastify")},14612:e=>{e.exports=import("socket.io-client")},71017:e=>{e.exports=require("path")}};var t=require("../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[5388,9908,895,9154,4924,2966,4146,4542,3579,273,5800,4096],()=>a(90121));module.exports=r})();